<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; A Short Intro to Packaging Your Code in R and Python – Building Reproducible Analytical Pipelines</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-rixpress.html" rel="next">
<link href="./05-unit-testing.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5cbd71c709c3387e4e7dab47f7b6899c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-2b28e90a16fd505ae23957488f4baea6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-5cbd71c709c3387e4e7dab47f7b6899c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="shortcut icon" href="img/favicon.ico">


<link rel="stylesheet" href="epub.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-packages.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A Short Intro to Packaging Your Code in R and Python</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Building Reproducible Analytical Pipelines</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/b-rodrigues/rap4mads_2025" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Building-Reproducible-Analytical-Pipelines.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Building-Reproducible-Analytical-Pipelines.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-intro-nix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reproducibility with Nix</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-functional-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Unit Testing: The Safety Net for Your Code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-packages.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A Short Intro to Packaging Your Code in R and Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-rixpress.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Building Reproducible Pipelines with Nix and <code>{rixpress}</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Containerization With Docker</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-github_actions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Intro to CI/CD with Github Actions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-what-else.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">What else should you learn?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-why-bother-packaging" id="toc-introduction-why-bother-packaging" class="nav-link active" data-scroll-target="#introduction-why-bother-packaging"><span class="header-section-number">5.1</span> Introduction: Why Bother Packaging?</a></li>
  <li><a href="#part-1-creating-an-r-package-with-usethis-and-devtools" id="toc-part-1-creating-an-r-package-with-usethis-and-devtools" class="nav-link" data-scroll-target="#part-1-creating-an-r-package-with-usethis-and-devtools"><span class="header-section-number">5.2</span> Part 1: Creating an R Package with <code>{usethis}</code> and <code>{devtools}</code></a>
  <ul class="collapse">
  <li><a href="#step-1-project-setup" id="toc-step-1-project-setup" class="nav-link" data-scroll-target="#step-1-project-setup"><span class="header-section-number">5.2.1</span> Step 1: Project Setup</a></li>
  <li><a href="#step-2-write-and-document-a-function" id="toc-step-2-write-and-document-a-function" class="nav-link" data-scroll-target="#step-2-write-and-document-a-function"><span class="header-section-number">5.2.2</span> Step 2: Write and Document a Function</a></li>
  <li><a href="#step-3-add-unit-tests" id="toc-step-3-add-unit-tests" class="nav-link" data-scroll-target="#step-3-add-unit-tests"><span class="header-section-number">5.2.3</span> Step 3: Add Unit Tests</a></li>
  <li><a href="#step-4-check-and-install" id="toc-step-4-check-and-install" class="nav-link" data-scroll-target="#step-4-check-and-install"><span class="header-section-number">5.2.4</span> Step 4: Check and Install</a></li>
  <li><a href="#step-5-install-from-github" id="toc-step-5-install-from-github" class="nav-link" data-scroll-target="#step-5-install-from-github"><span class="header-section-number">5.2.5</span> Step 5: Install from GitHub</a></li>
  <li><a href="#step-5bis-install-it-locally" id="toc-step-5bis-install-it-locally" class="nav-link" data-scroll-target="#step-5bis-install-it-locally"><span class="header-section-number">5.2.6</span> Step 5bis: Install it locally</a></li>
  </ul></li>
  <li><a href="#part-2-creating-a-minimal-python-package-with-uv" id="toc-part-2-creating-a-minimal-python-package-with-uv" class="nav-link" data-scroll-target="#part-2-creating-a-minimal-python-package-with-uv"><span class="header-section-number">5.3</span> Part 2: Creating a Minimal Python Package with uv</a>
  <ul class="collapse">
  <li><a href="#step-1-project-setup-with-uv" id="toc-step-1-project-setup-with-uv" class="nav-link" data-scroll-target="#step-1-project-setup-with-uv"><span class="header-section-number">5.3.1</span> Step 1: Project Setup with uv</a></li>
  <li><a href="#step-2-write-a-function-and-declare-dependencies" id="toc-step-2-write-a-function-and-declare-dependencies" class="nav-link" data-scroll-target="#step-2-write-a-function-and-declare-dependencies"><span class="header-section-number">5.3.2</span> Step 2: Write a Function and Declare Dependencies</a></li>
  <li><a href="#step-3-add-unit-tests-1" id="toc-step-3-add-unit-tests-1" class="nav-link" data-scroll-target="#step-3-add-unit-tests-1"><span class="header-section-number">5.3.3</span> Step 3: Add Unit Tests</a></li>
  <li><a href="#step-4-build-and-install" id="toc-step-4-build-and-install" class="nav-link" data-scroll-target="#step-4-build-and-install"><span class="header-section-number">5.3.4</span> Step 4: Build and Install</a></li>
  <li><a href="#step-5-install-from-github-1" id="toc-step-5-install-from-github-1" class="nav-link" data-scroll-target="#step-5-install-from-github-1"><span class="header-section-number">5.3.5</span> Step 5: Install from GitHub</a></li>
  </ul></li>
  <li><a href="#conclusion-the-packaging-mindset-in-the-age-of-ai" id="toc-conclusion-the-packaging-mindset-in-the-age-of-ai" class="nav-link" data-scroll-target="#conclusion-the-packaging-mindset-in-the-age-of-ai"><span class="header-section-number">5.4</span> Conclusion: The Packaging Mindset in the Age of AI</a></li>
  <li><a href="#hands-on-exercises" id="toc-hands-on-exercises" class="nav-link" data-scroll-target="#hands-on-exercises"><span class="header-section-number">5.5</span> Hands-on Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-build-your-first-python-package-with-nix" id="toc-exercise-1-build-your-first-python-package-with-nix" class="nav-link" data-scroll-target="#exercise-1-build-your-first-python-package-with-nix"><span class="header-section-number">5.5.1</span> Exercise 1: Build Your First Python Package with Nix</a></li>
  <li><a href="#exercise-2-build-and-package-an-r-tool-with-nix" id="toc-exercise-2-build-and-package-an-r-tool-with-nix" class="nav-link" data-scroll-target="#exercise-2-build-and-package-an-r-tool-with-nix"><span class="header-section-number">5.5.2</span> Exercise 2: Build and Package an R Tool with Nix</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/b-rodrigues/rap4mads_2025/edit/main/06-packages.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A Short Intro to Packaging Your Code in R and Python</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="text-align:center;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="img/packaging.png" class="img-fluid figure-img" width="512"></p>
</figure>
</div>
</div>
</div>
</div>
<p>What you’ll learn by the end of this chapter:</p>
<ul>
<li>Why organizing your code into a formal package is the ultimate form of reproducibility and reusability.</li>
<li>How to create, document, and test a basic R package using <code>{devtools}</code> and <code>{usethis}</code>.</li>
<li>How to create, document, and test a modern Python package using <code>uv</code> and <code>pytest</code>.</li>
<li>How to install your own packages directly from GitHub, enabling you to share your tools with colleagues and your future self.</li>
</ul>
<section id="introduction-why-bother-packaging" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introduction-why-bother-packaging"><span class="header-section-number">5.1</span> Introduction: Why Bother Packaging?</h2>
<p>So far, we have built a robust workflow based on three pillars: reproducible environments with Nix, reproducible history with Git, and reproducible logic with functional programming. We’ve organized our code into functions, which are a massive improvement over messy scripts.</p>
<p>The final, logical step in this journey is to treat our collection of functions not just as a set of helper scripts, but as a formal <strong>package</strong>. A package is more than just a folder of code; it’s a self-contained, distributable, and installable unit of software that bundles together code, data, documentation, and tests.</p>
<p>You might think, “I’m a data scientist, not a software engineer. Isn’t this overkill?” The answer is a definitive <strong>no</strong>. Packaging your code, even for an internal analysis project, provides enormous benefits:</p>
<ol type="1">
<li><p><strong>Reusability:</strong> Instead of copying and pasting your <code>clean_data()</code> function from project to project, you can simply <code>import mypackage</code> or <code>library(mypackage)</code> and use a single, trusted version.</p></li>
<li><p><strong>Distribution &amp; Collaboration:</strong> How do you share your work with a colleague? Emailing a zip file of scripts is a recipe for disaster. Sending them a single command—<code>devtools::install_github("my_repo")</code>—is robust and professional.</p></li>
<li><p><strong>Documentation:</strong> Packaging forces you into a standardized way of documenting your functions. This makes your code understandable to others and, more importantly, to yourself six months from now.</p></li>
<li><p><strong>Testing:</strong> A package provides a formal framework for running unit tests, ensuring that your functions work as expected and giving you the confidence to make changes without breaking things.</p></li>
<li><p><strong>Dependency Management:</strong> A package explicitly declares all of its dependencies (e.g., “this package needs <code>dplyr</code> version 1.1.0 or newer”). This solves a huge source of reproducibility errors.</p></li>
</ol>
<p>In this chapter, we will walk through the process of creating a simple package in both R and Python. The goal is not to become an expert package developer, but to understand the structure and benefits so you can apply this powerful “packaging mindset” to all your future projects.</p>
</section>
<section id="part-1-creating-an-r-package-with-usethis-and-devtools" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="part-1-creating-an-r-package-with-usethis-and-devtools"><span class="header-section-number">5.2</span> Part 1: Creating an R Package with <code>{usethis}</code> and <code>{devtools}</code></h2>
<p>The R community has developed an outstanding set of tools that make package development incredibly streamlined. The two essential packages are:</p>
<ul>
<li><strong><code>{devtools}</code>:</strong> Provides core development tools like <code>install()</code>, <code>test()</code>, and <code>check()</code>.</li>
<li><strong><code>{usethis}</code>:</strong> A workflow package that automates all the boilerplate. It creates files, sets up infrastructure, and guides you through the process.</li>
</ul>
<p>Let’s build a package called <code>cleanR</code>, which will contain a function to standardize column names. Create folder called <code>cleanR</code> and <code>cd</code> into it.</p>
<section id="step-1-project-setup" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="step-1-project-setup"><span class="header-section-number">5.2.1</span> Step 1: Project Setup</h3>
<p>First, make sure you have the necessary tools installed. Create a Nix environment that contains the following R packages: <code>{devtools}</code>, <code>{usethis}</code> and <code>{roxygen2}</code>.</p>
<p>Drop into this Nix shell, and let <code>{usethis}</code> create the package structure for you. From your R console, run:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">"~/Documents/projects/cleanR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will create a new <code>cleanR</code> directory with all the necessary files and subdirectories. It will also open a new RStudio session for that project. The key components are:</p>
<ul>
<li><code>R/</code>: This is where your R source code files will live.</li>
<li><code>DESCRIPTION</code>: A metadata file describing your package, its author, license, and dependencies.</li>
<li><code>NAMESPACE</code>: A file that declares which functions your package exports for users and which functions it imports from other packages. <strong>You should never edit this file by hand.</strong> <code>{roxygen2}</code> will manage it for you.</li>
</ul>
</section>
<section id="step-2-write-and-document-a-function" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="step-2-write-and-document-a-function"><span class="header-section-number">5.2.2</span> Step 2: Write and Document a Function</h3>
<p>Let’s create our function. <code>{usethis}</code> helps with this too:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"clean_names"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a new file <code>R/clean_names.R</code> and opens it for editing. Let’s add our function, including special comments for documentation. These <code>#'</code> comments are used by the <code>{roxygen2}</code> package to automatically generate the official documentation.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In R/clean_names.R</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Clean and Standardize Column Names</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function takes a data frame and returns a new data frame with</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' cleaned-up column names (lowercase, with underscores instead of spaces</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' or periods).</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df A data frame.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with standardized column names.</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' messy_df &lt;- data.frame("First Name" = c("Ada", "Bob"), "Last.Name" = c("Lovelace", "Ross"))</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' clean_names(messy_df)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>clean_names <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  old_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  new_names <span class="ot">&lt;-</span> <span class="fu">tolower</span>(old_names)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  new_names <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[ .]"</span>, <span class="st">"_"</span>, new_names)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> new_names</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The key tags here are:</p>
<ul>
<li><code>@param</code>: Describes a function argument.</li>
<li><code>@return</code>: Describes what the function returns.</li>
<li><code>@export</code>: This is crucial. It tells R that you want this function to be available to users when they load your package with <code>library(cleanR)</code>.</li>
<li><code>@examples</code>: Provides runnable examples that will appear in the help file.</li>
</ul>
<p>Now, run the magic command to process these comments:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This updates the <code>NAMESPACE</code> file and creates the help file (<code>man/clean_names.Rd</code>). You can now see your function’s help page with <code>?clean_names</code>.</p>
</section>
<section id="step-3-add-unit-tests" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="step-3-add-unit-tests"><span class="header-section-number">5.2.3</span> Step 3: Add Unit Tests</h3>
<p>A package without tests is a package waiting to break. <code>{usethis}</code> makes setting up tests trivial.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_testthat</span>() <span class="co"># Sets up the tests/testthat/ directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"clean_names"</span>) <span class="co"># Creates tests/testthat/test-clean_names.R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, edit the test file to add your expectations.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In tests/testthat/test-clean_names.R</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"clean_names works with spaces and periods"</span>, {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  messy_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"First Name"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"A"</span>), <span class="st">"Last.Name"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"B"</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  cleaned_df <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(messy_df)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  expected_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"first_name"</span>, <span class="st">"last_name"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">names</span>(cleaned_df), expected_names)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"clean_names handles already clean names"</span>, {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  clean_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The function should not change anything</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">names</span>(<span class="fu">clean_names</span>(clean_df)), <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To run all the tests for your package, use:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-check-and-install" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="step-4-check-and-install"><span class="header-section-number">5.2.4</span> Step 4: Check and Install</h3>
<p>The final step before sharing is to run the official R CMD check, the gold standard for package quality. This command runs all tests, checks documentation, and looks for common problems.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If your package passes with 0 errors, 0 warnings, and 0 notes, you are in great shape. If your package raises NOTEs or WARNINGs during the check phase, you can <em>most of the time</em> safely ignore these, especially if the package is only intented for internal usage. However, I would recommend that you still take care of the WARNINGs at the very least.</p>
<p>As a next step, you could edit the DESCRIPTION file. This is where you will list yourself as the package author, list the dependencies of the package and so on. I won’t got into detail here, but learning how to edit the DESCRIPTION file is important for actual package development (especially listing dependencies is key).</p>
<p>To use your package within a project, the simplest way is to host it on GitHub or build a <code>.tar.gz</code> file and install it locally.</p>
</section>
<section id="step-5-install-from-github" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="step-5-install-from-github"><span class="header-section-number">5.2.5</span> Step 5: Install from GitHub</h3>
<p>If you can publicly host your package, hosting it on GitHub is a good way to easily share your code, and install the package in your projects without needed to publish it on CRAN.</p>
<ol type="1">
<li><p>Create a new, empty repository on GitHub (e.g., <code>cleanR</code>).</p></li>
<li><p>In your local project, follow the instructions GitHub provides to link your local repository and push your code. This usually involves commands like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> remote add origin git@github.com:yourusername/cleanR.git</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> branch <span class="at">-M</span> main</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Now, anyone (including you on a different machine) can install your package with a single command (<strong>if you don’t use Nix</strong>):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You might need to install {remotes} first</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"yourusername/cleanR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>If you want to create an environment using Nix that includes this package, use the <code>git_pkgs</code> argument of <code>rix::rix()</code> to generate the right <code>default.nix</code> file.</p>
<p>Congratulations, you have created and shared a fully functional R package!</p>
</section>
<section id="step-5bis-install-it-locally" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="step-5bis-install-it-locally"><span class="header-section-number">5.2.6</span> Step 5bis: Install it locally</h3>
<p>If you can’t share your package on GitHub, the alternative is to build it locally using:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which will create a <code>.tar.gz</code> package. You can then install it using either <code>devtools::install_local()</code> if you don’t use Nix or the <code>local_r_pkgs</code> argument of <code>rix::rix()</code>.</p>
</section>
</section>
<section id="part-2-creating-a-minimal-python-package-with-uv" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="part-2-creating-a-minimal-python-package-with-uv"><span class="header-section-number">5.3</span> Part 2: Creating a Minimal Python Package with uv</h2>
<p>The Python packaging ecosystem is rapidly modernizing. While we use Nix to manage our overall environment, we still need to define the metadata and structure for our Python package. We will use <strong><code>uv</code></strong>, an extremely fast and modern tool, for one specific purpose: initializing our project’s configuration file. We will <strong>not</strong> use <code>uv</code> to manage a virtual environment, as Nix already handles that for us (unless you absolutely want to: however, you should then make sure that <code>uv</code> itself is being managed by Nix to ensure reproducibility).</p>
<p>Let’s build a Python package called <code>pyclean</code>, the equivalent of our R package.</p>
<section id="step-1-project-setup-with-uv" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="step-1-project-setup-with-uv"><span class="header-section-number">5.3.1</span> Step 1: Project Setup with uv</h3>
<p>First, ensure <code>uv</code> is installed in your Nix environment. Then, create a directory for your new package and initialize it:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> pyclean</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> pyclean</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> init <span class="at">--bare</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>--bare</code> flag is perfect for our Nix workflow. It creates only the essential <code>pyproject.toml</code> file without creating a virtual environment or extra directories. This leaves us with a clean slate.</p>
<p>Now, we must create the source and test directories manually. We’ll use the standard <code>src</code> layout:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> src/pyclean</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> tests</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/pyclean/__init__.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Your project structure should now look like this (check it using the <code>tree</code> command):</p>
<pre><code>pyclean/
├── pyproject.toml
├── src/
│   └── pyclean/
│       └── __init__.py
└── tests/</code></pre>
</section>
<section id="step-2-write-a-function-and-declare-dependencies" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="step-2-write-a-function-and-declare-dependencies"><span class="header-section-number">5.3.2</span> Step 2: Write a Function and Declare Dependencies</h3>
<p>Let’s create our <code>clean_names</code> function inside a new file, <code>src/pyclean/formatters.py</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In src/pyclean/formatters.py</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_names(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Clean and standardize column names of a DataFrame.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">        df: The input pandas DataFrame.</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">        A pandas DataFrame with standardized column names.</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    new_df <span class="op">=</span> df.copy()</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    new_cols <span class="op">=</span> {col: col.lower().replace(<span class="st">" "</span>, <span class="st">"_"</span>).replace(<span class="st">"."</span>, <span class="st">"_"</span>) <span class="cf">for</span> col <span class="kw">in</span> new_df.columns}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    new_df <span class="op">=</span> new_df.rename(columns<span class="op">=</span>new_cols)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To make this function easily importable, we expose it in <code>src/pyclean/__init__.py</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In src/pyclean/__init__.py</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .formatters <span class="im">import</span> clean_names</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>__version__ <span class="op">=</span> <span class="st">"0.1.0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we must declare our dependencies by manually editing <code>pyproject.toml</code>. We need <code>pandas</code> for our function and <code>pytest</code> for our tests.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In pyproject.toml</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"pyclean"</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">"A simple package to clean data."</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pandas&gt;=2.0.0"</span><span class="op">,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[project.optional-dependencies]</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dt">test</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pytest"</span><span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="kw">[tool.pytest.ini_options]</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="dt">pythonpath</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"src"</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>pythonpath = ["src"]</code> line is the key. Without it, you’d first need to install your <code>pyclean</code> library in editable mode using <code>pip</code> before running the tests. By adding this block, simply running <code>pytest</code> from the command line will work.</p>
</section>
<section id="step-3-add-unit-tests-1" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="step-3-add-unit-tests-1"><span class="header-section-number">5.3.3</span> Step 3: Add Unit Tests</h3>
<p>Create a new test file, <code>tests/test_formatters.py</code>, and add your tests.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In tests/test_formatters.py</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyclean <span class="im">import</span> clean_names</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_clean_names_happy_path():</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    messy_df <span class="op">=</span> pd.DataFrame({<span class="st">"First Name"</span>: [<span class="st">"Ada"</span>], <span class="st">"Last.Name"</span>: [<span class="st">"Lovelace"</span>]})</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    cleaned_df <span class="op">=</span> clean_names(messy_df)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    expected_cols <span class="op">=</span> [<span class="st">"first_name"</span>, <span class="st">"last_name"</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">list</span>(cleaned_df.columns) <span class="op">==</span> expected_cols</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_clean_names_is_idempotent():</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="op">=</span> pd.DataFrame({<span class="st">"first_name"</span>: [<span class="st">"a"</span>], <span class="st">"last_name"</span>: [<span class="st">"b"</span>]})</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    still_clean_df <span class="op">=</span> clean_names(clean_df)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">list</span>(still_clean_df.columns) <span class="op">==</span> <span class="bu">list</span>(clean_df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since your Nix environment provides all the tools, you can run tests directly from your terminal:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pytest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-build-and-install" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="step-4-build-and-install"><span class="header-section-number">5.3.4</span> Step 4: Build and Install</h3>
<p>To package your code, you need a build tool. It turns out that <code>uv</code> bundles a build tool with it, so we only need to call <code>uv build</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In your terminal, from the root of the 'pyclean' project</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> build</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a <code>dist/</code> directory containing a source distribution (<code>.tar.gz</code>) and a compiled wheel (<code>.whl</code>). The wheel is the modern standard for distribution.</p>
<p>Outside of a Nix shell, to use your package during development, you can install it in “editable” mode. This creates a link to your source code, so any changes you make are immediately reflected without needing to reinstall.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the package and its test dependencies</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-e</span> .<span class="pp">[</span><span class="ss">test</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But we are working from a Nix shell. Instead, we will simply edit our <code>default.nix</code> to update the <code>PYTHONPATH</code> environment variable, so our package can easily be found. If you look at the <code>default.nix</code> file of the course you’ve been using, you’ll see the following at the bottom:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode nix code-with-copy"><code class="sourceCode nix"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>shellHook = <span class="st">''</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">  export PYTHONPATH=$PWD/pyclean/src:$PYTHONPATH</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">''</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(you may need to adapt the path depending on where you’re developing the package). With this, dropping into the Nix shell, starting the Python interpreter and then typing <code>import pyclean</code> will work without any issues.</p>
</section>
<section id="step-5-install-from-github-1" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="step-5-install-from-github-1"><span class="header-section-number">5.3.5</span> Step 5: Install from GitHub</h3>
<p>Sharing via GitHub is the most common way to distribute packages that aren’t on the official Python Package Index (PyPI):</p>
<ol type="1">
<li>Create a new, empty repository on GitHub.</li>
<li>Push your local project to the remote repository.</li>
<li>Now, anyone can install your package directly from GitHub using <code>pip</code>, which is smart enough to find and process your <code>pyproject.toml</code> file: <code>bash     pip install git+https://github.com/yourusername/pyclean.git</code></li>
</ol>
<p>For Nix environments, add this to your <code>default.nix</code>:</p>
<pre><code>pyclean = pkgs.python313Packages.buildPythonPackage rec {
  pname = "pyclean";
  version = "0.1.0";
  src = pkgs.fetchgit {
    url = "https://github.com/b-rodrigues/pyclean";
    rev = "174d4d482d400536bb0d987a3e25ae80cd81ef3c";
    sha256 = "sha256-xTYydkuduPpZsCXE2fv5qZCnYYCRoNFpV7lQBM3LMSg=";
  };
  pyproject = true;
  propagatedBuildInputs = [ pkgs.python313Packages.pandas pkgs.python313Packages.setuptools ];
  # Add more dependencies to propagatedBuildInputs as needed
};</code></pre>
<p>You need to add the <code>rev</code>, which corresponds to the commit that want, and the <code>sha256</code>. To find the right <code>sha256</code>, start with an empty one (<code>sha256 = "";</code>) and try to build the package. The error message will give you the right <code>sha256</code>. Also not that this isn’t the the most idiomatic way to build a Python package for Nix, but it’s good enough for our purposes.</p>
<p>Finally, add <code>pyclean</code> to the <code>buildInputs</code> of the shell:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode nix code-with-copy"><code class="sourceCode nix"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  buildInputs = <span class="op">[</span> rpkgs pyconf pyclean tex system_packages github_pkgs <span class="op">]</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This process is naturally more involved than simply calling <code>pip install</code>, but it has the advantage of being entirely reproducible.</p>
</section>
</section>
<section id="conclusion-the-packaging-mindset-in-the-age-of-ai" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="conclusion-the-packaging-mindset-in-the-age-of-ai"><span class="header-section-number">5.4</span> Conclusion: The Packaging Mindset in the Age of AI</h2>
<p>You have now successfully created, tested, documented, and shared a basic package in both R and Python. While there is much more to learn about advanced package development, you have already mastered the most important part: the <strong>packaging mindset</strong>.</p>
<p>From now on, when you start a new analysis project, think of it as a small, internal package.</p>
<ul>
<li>Put your reusable logic into functions.</li>
<li>Place those functions in the <code>R/</code> or <code>mypackage/</code> source directory.</li>
<li>Document them.</li>
<li>Write a few simple tests to prove they work.</li>
<li>Manage dependencies formally in <code>DESCRIPTION</code> or <code>pyproject.toml</code>.</li>
</ul>
<p>Adopting this structure will make your work more robust, easier to share, and fundamentally more reproducible. It is the bridge between writing one-off scripts and building reliable, professional data science tools.</p>
<p>This packaging mindset becomes even more powerful when you introduce a modern collaborator: the LLM. The structured, component-based nature of a package is the perfect way to interact with AI assistants.</p>
<p>A package provides a clear contract and a well-defined structure that LLMs thrive on. Instead of a vague prompt like, “Refactor my messy analysis script,” you can now make precise, targeted requests:</p>
<ul>
<li>“Here is my function <code>clean_names</code>. Please write three <code>pytest</code> unit tests for it, including one for the happy path, one for an empty DataFrame, and one for names that are already clean.”</li>
<li>“Generate the roxygen2 documentation skeleton for this R function, including <code>@param</code>, <code>@return</code>, and <code>@examples</code> tags.”</li>
<li>“I need a function in my <code>pyclean/utils.py</code> module that calculates the Z-score for a pandas Series. Please generate the function and its docstring.”</li>
</ul>
<p>This synergy is a two-way street. Not only does the structure help you write better prompts, but LLMs excel at generating the very boilerplate that makes packaging robust. Tedious tasks like writing standard documentation headers, creating skeleton unit test files, or even generating a first draft of a function based on a clear description become near-instantaneous.</p>
<p>This elevates your role from a writer of code to an <strong>architect and a reviewer</strong>. Your job is to design the components (the functions), prompt the LLM to generate the implementation, and then—most critically—use the testing framework you just built to rigorously verify that the AI-generated code is correct, efficient, and robust. You are the final authority, and the package structure gives you the tools to enforce quality control.</p>
<p>By combining the discipline of packaging with the power of LLMs, you lower the barrier to adopting best practices like comprehensive testing and documentation. This combination doesn’t just make you faster; it makes you a more reliable and professional data scientist, capable of producing tools that are truly reproducible and built to last.</p>
<p>While a full guide to package development is beyond the scope of this course, it is the natural next step in your journey as a data scientist who produces reliable tools. When you are ready to take that step, here are the definitive resources to guide you:</p>
<ul>
<li><strong>For R:</strong> The “R Packages” (2e) book by Hadley Wickham and Jennifer Bryan is the essential, comprehensive guide. It covers everything from initial setup with <code>{usethis}</code> to testing, documentation, and submission to CRAN. <a href="https://r-pkgs.org/"><strong>Read it online here.</strong></a></li>
<li><strong>For Python:</strong> The official <a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/"><strong>Python Packaging User Guide</strong></a> is the place to start. For a more modern and streamlined approach that handles dependency management and publishing, many developers use tools like <a href="https://python-poetry.org/docs/"><strong>Poetry</strong></a> or <a href="https://hatch.pypa.io/latest/"><strong>Hatch</strong></a>.</li>
</ul>
<p>Treating your data analysis project like a small, internal software package, complete with functions and tests, is a powerful mindset that will elevate the quality and reliability of your work.</p>
<p>Here are two new exercises to add to the end of the chapter.</p>
</section>
<section id="hands-on-exercises" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="hands-on-exercises"><span class="header-section-number">5.5</span> Hands-on Exercises</h2>
<section id="exercise-1-build-your-first-python-package-with-nix" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="exercise-1-build-your-first-python-package-with-nix"><span class="header-section-number">5.5.1</span> Exercise 1: Build Your First Python Package with Nix</h3>
<p><strong>Goal:</strong> To build a complete, testable, and documented Python package and make it available in a reproducible Nix environment.</p>
<p>You will create a small Python package called <code>statstools</code>. This package will contain a single function that calculates descriptive statistics for a list of numbers.</p>
<p><strong>Requirements:</strong></p>
<ol type="1">
<li><p><strong>Project Structure:</strong> Create the following directory structure for your package: <code>bash     statstools/     ├── pyproject.toml     ├── default.nix     ├── src/     │   └── statstools/     │       ├── __init__.py     │       └── calculations.py     └── tests/         └── test_calculations.py</code></p></li>
<li><p><strong>Functionality:</strong> In <code>src/statstools/calculations.py</code>, create a function <code>descriptive_stats(numbers: list) -&gt; dict</code>. This function should take a list of numbers and return a dictionary containing the mean and standard deviation. Use the <code>numpy</code> library for the calculations.</p></li>
<li><p><strong>Documentation:</strong> Write a clear docstring for your <code>descriptive_stats</code> function explaining what it does, its parameters (<code>Args</code>), and what it returns (<code>Returns</code>).</p></li>
<li><p><strong>Dependencies:</strong> In your <code>pyproject.toml</code> file:</p>
<ul>
<li>Define the project name as <code>statstools</code> and give it a version of <code>0.1.0</code>.</li>
<li>Add <code>numpy</code> as a runtime dependency.</li>
<li>Add <code>pytest</code> as an optional dependency for testing.</li>
<li>Add the <code>[tool.pytest.ini_options]</code> block to set the <code>pythonpath</code> correctly so <code>pytest</code> can find your <code>src</code> directory.</li>
</ul></li>
<li><p><strong>Unit Tests:</strong> In <code>tests/test_calculations.py</code>, write at least two tests for your function using <code>pytest</code>:</p>
<ul>
<li>A “happy path” test with a simple list like <code>[1, 2, 3, 4, 5]</code>.</li>
<li>A test with negative numbers and floats.</li>
</ul></li>
<li><p><strong>GitHub Repository:</strong> Push your completed package to a new public repository on GitHub.</p></li>
<li><p><strong>Nix Expression:</strong> This is the most critical part. Create a <code>default.nix</code> file in the root of your project. This file should:</p>
<ul>
<li>Fetch your package’s source code from your GitHub repository using <code>pkgs.fetchgit</code>. You will need to get the commit hash (<code>rev</code>) and the <code>sha256</code> hash (remember, you can get the correct <code>sha256</code> from the error message when you first try to build with an empty <code>sha256 = "";</code>).</li>
<li>Define your package using <code>pkgs.python3Packages.buildPythonPackage</code>. Ensure you set <code>pyproject = true;</code> and list its dependencies (<code>numpy</code>, <code>pytest</code>) in <code>propagatedBuildInputs</code>.</li>
<li>Create a reproducible shell using <code>pkgs.mkShell</code> that includes both your <code>statstools</code> package and the Python interpreter.</li>
<li><strong>Hint:</strong> Look closely at the <code>default.nix</code> file from the main course repository for a complete example of how a Python package is fetched from GitHub and built.</li>
</ul></li>
</ol>
<p><strong>To verify your work:</strong> * Run <code>pytest</code> from within the Nix shell to ensure all your tests pass. * Start a Python interpreter inside the Nix shell and successfully run <code>from     statstools import descriptive_stats</code>.</p>
</section>
<section id="exercise-2-build-and-package-an-r-tool-with-nix" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="exercise-2-build-and-package-an-r-tool-with-nix"><span class="header-section-number">5.5.2</span> Exercise 2: Build and Package an R Tool with Nix</h3>
<p><strong>Goal:</strong> To apply R’s best practices for package development (<code>usethis</code>, <code>devtools</code>, <code>roxygen2</code>) and integrate the final product into a reproducible Nix environment.</p>
<p>You will create a small R package called <code>datasummary</code>. This package will provide a function to quickly summarize a data frame.</p>
<p><strong>Requirements:</strong></p>
<ol type="1">
<li><p><strong>Project Setup:</strong> Use <code>usethis::create_package("datasummary")</code> to generate the standard R package structure.</p></li>
<li><p><strong>Functionality:</strong></p>
<ul>
<li>Use <code>usethis::use_r("summarize_df")</code> to create a new file for your function.</li>
<li>The function, <code>summarize_df(df)</code>, should take a data frame as input.</li>
<li>It should return a new data frame with two columns: <code>column_name</code> and <code>missing_values</code>, showing the count of <code>NA</code>s in each column of the input data frame.</li>
<li>This function will require the <code>{dplyr}</code> package. Use <code>usethis::use_package("dplyr")</code> to declare this dependency in your <code>DESCRIPTION</code> file.</li>
</ul></li>
<li><p><strong>Documentation:</strong></p>
<ul>
<li>Use <code>roxygen2</code> comments to document your <code>summarize_df</code> function.</li>
<li>Include <code>@param</code>, <code>@return</code>, and <code>@export</code> tags.</li>
<li>Provide a working example in the <code>@examples</code> tag.</li>
<li>Since your function will use functions from <code>{dplyr}</code>, add the appropriate <code>@importFrom</code> tags (e.g., <code>@importFrom dplyr %&gt;%     summarise_all</code>).</li>
<li>Run <code>devtools::document()</code> to generate the documentation.</li>
</ul></li>
<li><p><strong>Unit Tests:</strong></p>
<ul>
<li>Set up testing with <code>usethis::use_testthat()</code>.</li>
<li>Create a test file with <code>usethis::use_test("summarize_df")</code>.</li>
<li>In the test file, write at least one test using <code>test_that()</code> that creates a sample data frame with missing values and checks if your function returns the correct counts.</li>
<li>Run <code>devtools::test()</code> to execute your tests.</li>
</ul></li>
<li><p><strong>Quality Check:</strong> Run <code>devtools::check()</code> to ensure your package is free of errors, warnings, and notes.</p></li>
<li><p><strong>GitHub Repository:</strong> Push your completed R package to a new public repository on GitHub.</p></li>
<li><p><strong>Nix Expression:</strong> Create a <code>default.nix</code> file in the root of your <code>datasummary</code> project. This file must:</p>
<ul>
<li>Define a custom R environment.</li>
<li>Define your <code>datasummary</code> package by using <code>buildRPackage</code>. Fetch the source from your GitHub repository using <code>pkgs.fetchgit</code> (you will need the <code>rev</code> and <code>sha256</code>).</li>
<li>Make sure to list its R dependencies (like <code>{dplyr}</code> and its own dependencies) in <code>propagatedBuildInputs</code>.</li>
<li>Create a final shell with <code>pkgs.mkShell</code> that drops you into an R session where your <code>datasummary</code> package is installed and available.</li>
<li><strong>Hint:</strong> Refer to the main course repository’s <code>default.nix</code> file to see how R packages are defined with <code>buildRPackage</code> and included in the final R environment. Using <code>{rix}</code> is also an option.</li>
</ul></li>
</ol>
<p><strong>To verify your work:</strong> * Drop into the Nix shell provided by your <code>default.nix</code>. * Start an R session. * Successfully run <code>library(datasummary)</code> and test your <code>summarize_df()</code> function on a data frame like <code>iris</code>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05-unit-testing.html" class="pagination-link" aria-label="Unit Testing: The Safety Net for Your Code">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Unit Testing: The Safety Net for Your Code</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-rixpress.html" class="pagination-link" aria-label="Building Reproducible Pipelines with Nix and `{rixpress}`">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Building Reproducible Pipelines with Nix and <code>{rixpress}</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/b-rodrigues/rap4mads_2025/edit/main/06-packages.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>